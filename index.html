<!doctype HTML>
<html>
<head>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	
	<title>KAS Live</title>
	<link href="assets/css/bootstrap-theme.css" rel="stylesheet">

	<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700" rel="stylesheet">

	<script   src="https://code.jquery.com/jquery-3.1.1.min.js"   
	integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script>

	<script src="assets/js/time.js" ></script>

<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

	<link rel="stylesheet" type="text/css" href="style.css">

	<script src="assets/js/tabletop-master/src/tabletop.js"></script>
	<script src="assets/js/underscore.js"></script>
	<script src="assets/js/jquery.webticker.min.js"></script>
	<script src="https://use.fontawesome.com/31f4a97978.js"></script>


	
	
</head>
<body>
	<div class="container-fluid">
		<div class="row vertical-align">
			<div class="col-md-8">
			<img src="assets/kas.png" class="img-responsive center-block" alt="kas logo" style="width:15%"/>
			</div>
			<div class="col-md-4">
				<div class="text-center">
					<span id="time"></span> <span id="ampm"></span><br>
					<span id="cal"></span>
				</div>
			</div>
		</div>
		<div class="row vertical-align margin-spacing">
			<div class="col-md-8">
				<div class="text-center news-ticker" id="n-ticker">COOL NEWS TICKER</div>
			</div>
			<div class="col-md-4">
				<div class="row vertical-align">
					<div class="col-md-6">
						<div class="text-center">
							<span class="data-header">MS Block</span><br>
							<span id="ms" class="data"></span>
						</div>
					</div>
					<div class="col-md-6">
						<div class="text-center">
							<span class="data-header">HS Block</span><br>
							<span id="hs" class="data"></span>
						</div>
					</div>
				</div>
			</div>

		</div>
		<div class="row vertical-align text-center margin-spacing">
			<div class="col-md-8">VIDEO</div>
			<div class="col-md-4">
				<div class="row">
					<div class="icon col-md-3">
						<i class="fa fa-cloud"></i>
					</div>
					<div class="col-md-9">
					<div class="row text-left">
						<div class="col-md-12">
							<span class="data data-air" id="aqidescription">AQI</span>
						</div>
					</div>
					<div class="row text-left">
						<div class="col-md-2">AQI: </div>
						<div class="col-md-10">
							<span class="data data-air" id="aqi"></span>
						</div>
					</div>
					<div class="row text-left">
						<div class="col-md-2">Tmp: </div>
						<div class="col-md-10">###</div>
					</div>
					<div class="row text-left">
						<div class="col-md-2">**: </div>
						<div class="col-md-10">
							<span class="data-header small-text" id="updatetime"></span>
						</div>
					</div>
					</div>
				</div>
				<div class="row margin-spacing">
					<div class="icon col-md-3">
					<i class="fa fa-twitter" aria-hidden="true"></i>
					</div>
					<div class="col-md-9">TWITTER</div>
				</div>
				<div class="row margin-spacing">
					<div class="icon col-md-3">
						<i class="fa fa-calendar"></i>
					</div>
					<div class="col-md-9">CALENDAR</div>
				</div>
			</div>
		</div>
	</div>


	<script type="text/javascript">

		//new idea brief for next time
		//we have two arrays and we fetch a new array or something

		  var public_spreadsheet_url = 'https://docs.google.com/spreadsheets/d/11Z_TJTHhb7Ivuq5swt5HYnJTSl9-cGMo3kKQ5768VUM/pubhtml';
		  var array = []; //i need a better name; array for info
		  function init() {
		    Tabletop.init( { key: public_spreadsheet_url,
		                     callback: showInfo,
		                     simpleSheet: true } )
		  }

		 	function showInfo(data, tabletop) {
		 		newArray = []
		 		$.each(data, function(index, item) {
		 			newArray.push(data[index].Announcements)
		 		})
		 		array.sort();
		 		newArray.sort();
		 		if(_.isEqual(array, newArray)) {
		 		} else {
		 			array = newArray;
		 			callTicker();
		 		}
			}

		  	function callTicker() {
		  		var html = ""
		  		$.each(array, function(index, item) {
		 			console.log(array[index]);
		 			html += "<li> | " + array[index] + "</li>"
		 		})
		 		// $('#tickers').html("");
		 		$('#n-ticker').append(html);
		 		$('#n-ticker').webTicker('update', html, 'swap', true, false)
			}
	</script>

	<script>
function getAQI() {

	// IDK actually how to use webservices but this seems to work??
	//http://opendata.epa.gov.tw/Data/Details/AQI/?show=all
	$.ajax({
	url: "http://opendata.epa.gov.tw/webapi/api/rest/datastore/355000000I-001805?filters=SiteName%20eq%20'左營'&sort=SiteName&offset=0&format=json&token=+FnNny1OD023y6sJSIyDmA",
	dataType: "jsonp",
	success: function(data) {
		// var json = $.parseJSON(data);
		var json = data;

		for (arr in json.result.records) {
			var site = json.result.records[arr].SiteName;
			if (site == "左營") {
				var pm = json.result.records[arr]["PM2.5"]
				var aqi = json.result.records[arr]["AQI"]
				var update = json.result.records[arr]["PublishTime"]
				//TESTING USE BECAUSE ITS DUMB AND NOT WORKING
				// pm = 200	;
				

				var pm25quality;
				$('#pm25').removeClass("pm-low pm-med pm-high pm-vhigh")
				if (!pm) {
					// data is gone!
					pm25quality = "--"
				} else if (pm < 36) {
					//low
					$('#pm25').addClass("pm-low");
					pm25quality = "low"
				} else if (pm < 54) {
					//moderate
					$('#pm25').addClass("pm-med");
					pm25quality = "moderate"
				} else if (pm < 71) {
					//high
					$('#pm25').addClass("pm-high");
					pm25quality = "high"
				} else {
					//very high
					$('#pm25').addClass("pm-vhigh");
					pm25quality = "very high"
				}

				var aqiquality;
				$('#aqi').removeClass("air-good air-moderate air-unhealthsensitive air-unhealthy air-veryunhealthy air-hazardous");
				$('#aqidescription').removeClass("air-good air-moderate air-unhealthsensitive air-unhealthy air-veryunhealthy air-hazardous");

				if (!aqi) {
					aqiquality = "--"
				} else if (aqi < 51) {
					aqiquality = "Good"
					$('#aqi').addClass("air-good")
					$('#aqidescription').addClass("air-good")
				} else if (aqi < 101) {
					aqiquality = "Moderate"
					$('#aqi').addClass("air-moderate")
					$('#aqidescription').addClass("air-moderate")
				} else if (aqi < 151) {
					aqiquality = "Unhealthy for sensitive groups"
					$('#aqi').addClass("air-unhealthsensitive")
					$('#aqidescription').addClass("air-unhealthsensitive")
				} else if (aqi < 201) {
					aqiquality = "Unhealthy"
					$('#aqi').addClass("air-unhealthy")
					$('#aqidescription').addClass("air-unhealthy")
				} else if (aqi < 301) {
					aqiquality = "Very unhealthy"
					$('#aqi').addClass("air-veryunhealthy")
					$('#aqidescription').addClass("air-veryunhealthy")
				} else {
					aqiquality = "Hazardous"
					$('#aqi').addClass("air-hazardous")
					$('#aqidescription').addClass("air-hazardous")
				}

				var pmDisplay = pm25quality == "--" ? "--" : pm + " μg/m3 (" + pm25quality + ")" 
				$('#pm25').html(pmDisplay);	
				$('#aqi').html(aqi);
				$('#aqidescription').html(aqiquality);
				$('#updatetime').html(update);

			}
		}
		
	}
});
}
	</script>


	<script>
	$(document).ready(function() {
		myTime();
		init();
		getAQI();
		var aqiRefresh = setInterval(getAQI, 1000 * 1800); //update every half hour
	});
	</script>
	<script>
	$('#n-ticker').webTicker({
		height: '36px',
		speed: 75,
		hoverpause: false,
		duplicate: true,
		startEmpty: true,
	});
	</script>


	
</body>
</html>